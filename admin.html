<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ClockWork Admin Dashboard">
    <meta name="theme-color" content="#f97316">
    <title>ClockWork Admin Dashboard</title>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        clockwork: { orange: '#f97316', dark: '#0a0a0a', darker: '#050505' }
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html { scroll-behavior: smooth; }
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.08); }
        .glow { box-shadow: 0 0 30px rgba(249, 115, 22, 0.3); }
        .stat-card { background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.02) 100%); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // API Configuration
        const API_BASE = window.location.hostname === 'localhost'
            ? 'http://localhost:5000/api'
            : 'https://cwbackend-production.up.railway.app/api';

        // API Helper
        const api = {
            async fetch(endpoint, options = {}) {
                const token = localStorage.getItem('adminToken');
                const res = await fetch(`${API_BASE}${endpoint}`, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': token ? `Bearer ${token}` : '',
                        ...options.headers
                    }
                });
                const data = await res.json();
                if (!res.ok) throw new Error(data.message || 'Request failed');
                return data;
            }
        };

        // Login Component
        function LoginForm({ onLogin }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    const res = await api.fetch('/auth/login', {
                        method: 'POST',
                        body: JSON.stringify({ email, password })
                    });

                    localStorage.setItem('adminToken', res.token);

                    // Test admin access
                    await api.fetch('/admin/stats');
                    onLogin(res.user);
                } catch (err) {
                    setError(err.message === 'Admin access required'
                        ? 'You do not have admin access. Contact support.'
                        : err.message);
                    localStorage.removeItem('adminToken');
                }
                setLoading(false);
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="glass rounded-2xl p-8 w-full max-w-md">
                        <div className="text-center mb-8">
                            <div className="text-4xl mb-2"><i className="fas fa-bolt text-orange-500"></i></div>
                            <h1 className="text-2xl font-bold">ClockWork Admin</h1>
                            <p className="text-gray-400 mt-2">Sign in with your admin account</p>
                        </div>

                        {error && (
                            <div className="bg-red-500/20 border border-red-500/50 rounded-lg p-3 mb-4 text-red-300 text-sm">
                                {error}
                            </div>
                        )}

                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-gray-400 text-sm mb-2">Email</label>
                                <input
                                    type="email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    className="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-orange-500"
                                    placeholder="admin@example.com"
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-gray-400 text-sm mb-2">Password</label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-orange-500"
                                    placeholder="********"
                                    required
                                />
                            </div>
                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 rounded-lg transition-colors disabled:opacity-50"
                            >
                                {loading ? 'Signing in...' : 'Sign In'}
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        // Stat Card Component
        function StatCard({ icon, label, value, subValue, color = 'orange' }) {
            const colors = {
                orange: 'text-orange-500',
                green: 'text-green-500',
                blue: 'text-blue-500',
                purple: 'text-purple-500',
                yellow: 'text-yellow-500'
            };

            return (
                <div className="stat-card rounded-xl p-4 border border-white/10">
                    <div className="flex items-center gap-3">
                        <div className={`text-2xl ${colors[color]}`}>
                            <i className={`fas fa-${icon}`}></i>
                        </div>
                        <div>
                            <div className="text-gray-400 text-sm">{label}</div>
                            <div className="text-2xl font-bold">{value?.toLocaleString() || 0}</div>
                            {subValue && <div className="text-xs text-gray-500">{subValue}</div>}
                        </div>
                    </div>
                </div>
            );
        }

        // User Row Component
        function UserRow({ user, onAddVIP, onRemoveVIP }) {
            const tierColors = {
                free: 'bg-gray-500',
                pro: 'bg-blue-500',
                vip: 'bg-yellow-500',
                elite: 'bg-purple-500',
                coach_starter: 'bg-green-500',
                coach_pro: 'bg-green-600',
                coach_scale: 'bg-green-700',
                coach_enterprise: 'bg-green-800'
            };

            const typeColors = {
                individual: 'text-blue-400',
                coach: 'text-green-400',
                client: 'text-purple-400'
            };

            const tier = user.subscription?.tier || 'free';
            const isVIP = tier === 'vip';

            return (
                <tr className="border-b border-white/5 hover:bg-white/5">
                    <td className="py-3 px-4">
                        <div className="font-medium">{user.name}</div>
                        <div className="text-gray-500 text-sm">{user.email}</div>
                    </td>
                    <td className="py-3 px-4">
                        <span className={`${typeColors[user.userType]} capitalize`}>
                            {user.userType}
                        </span>
                    </td>
                    <td className="py-3 px-4">
                        <span className={`${tierColors[tier]} text-white text-xs px-2 py-1 rounded-full`}>
                            {tier.replace('_', ' ').toUpperCase()}
                        </span>
                        {user.isEnvVIP && (
                            <span className="ml-1 text-yellow-500 text-xs" title="Set via VIP_EMAILS env var">
                                <i className="fas fa-star"></i>
                            </span>
                        )}
                    </td>
                    <td className="py-3 px-4 text-gray-400 text-sm">
                        {new Date(user.createdAt).toLocaleDateString()}
                    </td>
                    <td className="py-3 px-4 text-gray-400 text-sm">
                        {user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : 'Never'}
                    </td>
                    <td className="py-3 px-4">
                        {isVIP ? (
                            <button
                                onClick={() => onRemoveVIP(user.email)}
                                disabled={user.isEnvVIP}
                                className={`text-red-400 hover:text-red-300 text-sm ${user.isEnvVIP ? 'opacity-50 cursor-not-allowed' : ''}`}
                                title={user.isEnvVIP ? 'Remove from VIP_EMAILS env var' : 'Remove VIP'}
                            >
                                <i className="fas fa-crown-alt mr-1"></i>
                                Remove VIP
                            </button>
                        ) : (
                            <button
                                onClick={() => onAddVIP(user.email)}
                                className="text-yellow-400 hover:text-yellow-300 text-sm"
                            >
                                <i className="fas fa-crown mr-1"></i>
                                Make VIP
                            </button>
                        )}
                    </td>
                </tr>
            );
        }

        // Main Dashboard Component
        function AdminDashboard({ user, onLogout }) {
            const [stats, setStats] = useState(null);
            const [users, setUsers] = useState([]);
            const [vipUsers, setVipUsers] = useState([]);
            const [pagination, setPagination] = useState({ page: 1, pages: 1, total: 0 });
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('overview');
            const [search, setSearch] = useState('');
            const [filterType, setFilterType] = useState('');
            const [filterTier, setFilterTier] = useState('');
            const [newVIPEmail, setNewVIPEmail] = useState('');
            const [message, setMessage] = useState(null);

            const loadStats = useCallback(async () => {
                try {
                    const res = await api.fetch('/admin/stats');
                    setStats(res.data);
                } catch (err) {
                    console.error('Failed to load stats:', err);
                }
            }, []);

            const loadUsers = useCallback(async (page = 1) => {
                try {
                    const params = new URLSearchParams({ page, limit: 20 });
                    if (search) params.append('search', search);
                    if (filterType) params.append('userType', filterType);
                    if (filterTier) params.append('tier', filterTier);

                    const res = await api.fetch(`/admin/users?${params}`);
                    setUsers(res.data.users);
                    setPagination(res.data.pagination);
                } catch (err) {
                    console.error('Failed to load users:', err);
                }
            }, [search, filterType, filterTier]);

            const loadVIPUsers = useCallback(async () => {
                try {
                    const res = await api.fetch('/admin/vip');
                    setVipUsers(res.data.vipUsers);
                } catch (err) {
                    console.error('Failed to load VIP users:', err);
                }
            }, []);

            useEffect(() => {
                const init = async () => {
                    setLoading(true);
                    await Promise.all([loadStats(), loadUsers(), loadVIPUsers()]);
                    setLoading(false);
                };
                init();
            }, []);

            useEffect(() => {
                if (!loading) {
                    loadUsers(1);
                }
            }, [search, filterType, filterTier]);

            const showMessage = (text, type = 'success') => {
                setMessage({ text, type });
                setTimeout(() => setMessage(null), 3000);
            };

            const handleAddVIP = async (email) => {
                try {
                    await api.fetch('/admin/vip', {
                        method: 'POST',
                        body: JSON.stringify({ email })
                    });
                    showMessage(`${email} upgraded to VIP!`);
                    loadUsers(pagination.page);
                    loadVIPUsers();
                    loadStats();
                } catch (err) {
                    showMessage(err.message, 'error');
                }
            };

            const handleRemoveVIP = async (email) => {
                if (!confirm(`Remove VIP status from ${email}?`)) return;
                try {
                    await api.fetch(`/admin/vip/${encodeURIComponent(email)}`, {
                        method: 'DELETE'
                    });
                    showMessage(`VIP status removed from ${email}`);
                    loadUsers(pagination.page);
                    loadVIPUsers();
                    loadStats();
                } catch (err) {
                    showMessage(err.message, 'error');
                }
            };

            const handleAddNewVIP = async (e) => {
                e.preventDefault();
                if (!newVIPEmail) return;
                await handleAddVIP(newVIPEmail);
                setNewVIPEmail('');
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-4xl mb-4"><i className="fas fa-spinner fa-spin text-orange-500"></i></div>
                            <div className="text-gray-400">Loading dashboard...</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <header className="glass border-b border-white/10 sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <i className="fas fa-bolt text-orange-500 text-2xl"></i>
                                <h1 className="text-xl font-bold">ClockWork Admin</h1>
                            </div>
                            <div className="flex items-center gap-4">
                                <span className="text-gray-400 text-sm">{user.email}</span>
                                <button
                                    onClick={onLogout}
                                    className="text-gray-400 hover:text-white"
                                >
                                    <i className="fas fa-sign-out-alt"></i>
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Message Toast */}
                    {message && (
                        <div className={`fixed top-20 right-4 z-50 px-4 py-3 rounded-lg ${message.type === 'error' ? 'bg-red-500' : 'bg-green-500'} text-white shadow-lg`}>
                            {message.text}
                        </div>
                    )}

                    {/* Navigation Tabs */}
                    <div className="max-w-7xl mx-auto px-4 py-4">
                        <div className="flex gap-2 overflow-x-auto scrollbar-hide">
                            {['overview', 'users', 'vip'].map(tab => (
                                <button
                                    key={tab}
                                    onClick={() => setActiveTab(tab)}
                                    className={`px-4 py-2 rounded-lg whitespace-nowrap transition-colors ${
                                        activeTab === tab
                                            ? 'bg-orange-500 text-white'
                                            : 'bg-white/5 text-gray-400 hover:bg-white/10'
                                    }`}
                                >
                                    {tab === 'overview' && <><i className="fas fa-chart-line mr-2"></i>Overview</>}
                                    {tab === 'users' && <><i className="fas fa-users mr-2"></i>Users</>}
                                    {tab === 'vip' && <><i className="fas fa-crown mr-2"></i>VIP Management</>}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-4 pb-8">
                        {/* Overview Tab */}
                        {activeTab === 'overview' && stats && (
                            <div className="space-y-6">
                                {/* Key Metrics */}
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    <StatCard icon="users" label="Total Users" value={stats.overview.totalUsers} color="blue" />
                                    <StatCard icon="credit-card" label="Subscribers" value={stats.overview.totalSubscribers} color="green" />
                                    <StatCard icon="crown" label="VIP Users" value={stats.overview.vipUsers} color="yellow" />
                                    <StatCard icon="dumbbell" label="Workouts" value={stats.overview.totalWorkouts} color="purple" />
                                </div>

                                {/* Signups */}
                                <div className="glass rounded-xl p-6">
                                    <h2 className="text-lg font-bold mb-4"><i className="fas fa-user-plus text-orange-500 mr-2"></i>New Signups</h2>
                                    <div className="grid grid-cols-3 gap-4">
                                        <div className="text-center">
                                            <div className="text-3xl font-bold text-green-400">{stats.signups.today}</div>
                                            <div className="text-gray-400 text-sm">Today</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-3xl font-bold text-blue-400">{stats.signups.thisWeek}</div>
                                            <div className="text-gray-400 text-sm">This Week</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-3xl font-bold text-purple-400">{stats.signups.thisMonth}</div>
                                            <div className="text-gray-400 text-sm">This Month</div>
                                        </div>
                                    </div>
                                </div>

                                {/* Activity */}
                                <div className="glass rounded-xl p-6">
                                    <h2 className="text-lg font-bold mb-4"><i className="fas fa-fire text-orange-500 mr-2"></i>User Activity</h2>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="text-center">
                                            <div className="text-3xl font-bold text-orange-400">{stats.activity.activeToday}</div>
                                            <div className="text-gray-400 text-sm">Active Today</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-3xl font-bold text-orange-300">{stats.activity.activeThisWeek}</div>
                                            <div className="text-gray-400 text-sm">Active This Week</div>
                                        </div>
                                    </div>
                                </div>

                                {/* User Types & Tiers */}
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div className="glass rounded-xl p-6">
                                        <h2 className="text-lg font-bold mb-4"><i className="fas fa-user-tag text-blue-500 mr-2"></i>Users by Type</h2>
                                        <div className="space-y-2">
                                            {Object.entries(stats.usersByType).map(([type, count]) => (
                                                <div key={type} className="flex justify-between items-center">
                                                    <span className="capitalize text-gray-300">{type}</span>
                                                    <span className="font-bold">{count}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="glass rounded-xl p-6">
                                        <h2 className="text-lg font-bold mb-4"><i className="fas fa-layer-group text-green-500 mr-2"></i>Users by Tier</h2>
                                        <div className="space-y-2">
                                            {Object.entries(stats.usersByTier).map(([tier, count]) => (
                                                <div key={tier} className="flex justify-between items-center">
                                                    <span className="capitalize text-gray-300">{tier?.replace('_', ' ') || 'Unknown'}</span>
                                                    <span className="font-bold">{count}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                {/* Subscribers Breakdown */}
                                {Object.keys(stats.subscribers).length > 0 && (
                                    <div className="glass rounded-xl p-6">
                                        <h2 className="text-lg font-bold mb-4"><i className="fas fa-credit-card text-green-500 mr-2"></i>Paid Subscribers</h2>
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                            {Object.entries(stats.subscribers).map(([tier, count]) => (
                                                <div key={tier} className="text-center p-3 bg-white/5 rounded-lg">
                                                    <div className="text-2xl font-bold text-green-400">{count}</div>
                                                    <div className="text-gray-400 text-sm capitalize">{tier.replace('_', ' ')}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Users Tab */}
                        {activeTab === 'users' && (
                            <div className="space-y-4">
                                {/* Filters */}
                                <div className="glass rounded-xl p-4">
                                    <div className="flex flex-wrap gap-4">
                                        <div className="flex-1 min-w-[200px]">
                                            <input
                                                type="text"
                                                value={search}
                                                onChange={(e) => setSearch(e.target.value)}
                                                placeholder="Search by email or name..."
                                                className="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-orange-500"
                                            />
                                        </div>
                                        <select
                                            value={filterType}
                                            onChange={(e) => setFilterType(e.target.value)}
                                            className="bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-orange-500"
                                        >
                                            <option value="">All Types</option>
                                            <option value="individual">Individual</option>
                                            <option value="coach">Coach</option>
                                            <option value="client">Client</option>
                                        </select>
                                        <select
                                            value={filterTier}
                                            onChange={(e) => setFilterTier(e.target.value)}
                                            className="bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-orange-500"
                                        >
                                            <option value="">All Tiers</option>
                                            <option value="free">Free</option>
                                            <option value="pro">Pro</option>
                                            <option value="vip">VIP</option>
                                            <option value="elite">Elite</option>
                                            <option value="coach_starter">Coach Starter</option>
                                            <option value="coach_pro">Coach Pro</option>
                                        </select>
                                    </div>
                                </div>

                                {/* Users Table */}
                                <div className="glass rounded-xl overflow-hidden">
                                    <div className="overflow-x-auto">
                                        <table className="w-full">
                                            <thead className="bg-white/5">
                                                <tr className="text-left text-gray-400 text-sm">
                                                    <th className="py-3 px-4">User</th>
                                                    <th className="py-3 px-4">Type</th>
                                                    <th className="py-3 px-4">Tier</th>
                                                    <th className="py-3 px-4">Joined</th>
                                                    <th className="py-3 px-4">Last Active</th>
                                                    <th className="py-3 px-4">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {users.map(u => (
                                                    <UserRow
                                                        key={u._id}
                                                        user={u}
                                                        onAddVIP={handleAddVIP}
                                                        onRemoveVIP={handleRemoveVIP}
                                                    />
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>

                                    {/* Pagination */}
                                    <div className="border-t border-white/10 px-4 py-3 flex items-center justify-between text-sm">
                                        <div className="text-gray-400">
                                            Showing {users.length} of {pagination.total} users
                                        </div>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => loadUsers(pagination.page - 1)}
                                                disabled={pagination.page <= 1}
                                                className="px-3 py-1 bg-white/5 rounded disabled:opacity-50"
                                            >
                                                Previous
                                            </button>
                                            <span className="px-3 py-1">
                                                Page {pagination.page} of {pagination.pages}
                                            </span>
                                            <button
                                                onClick={() => loadUsers(pagination.page + 1)}
                                                disabled={pagination.page >= pagination.pages}
                                                className="px-3 py-1 bg-white/5 rounded disabled:opacity-50"
                                            >
                                                Next
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* VIP Management Tab */}
                        {activeTab === 'vip' && (
                            <div className="space-y-6">
                                {/* Add VIP Form */}
                                <div className="glass rounded-xl p-6">
                                    <h2 className="text-lg font-bold mb-4"><i className="fas fa-crown text-yellow-500 mr-2"></i>Add VIP User</h2>
                                    <form onSubmit={handleAddNewVIP} className="flex gap-4">
                                        <input
                                            type="email"
                                            value={newVIPEmail}
                                            onChange={(e) => setNewVIPEmail(e.target.value)}
                                            placeholder="Enter user email..."
                                            className="flex-1 bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-orange-500"
                                            required
                                        />
                                        <button
                                            type="submit"
                                            className="bg-yellow-500 hover:bg-yellow-600 text-black font-bold px-6 py-2 rounded-lg transition-colors"
                                        >
                                            <i className="fas fa-crown mr-2"></i>Add VIP
                                        </button>
                                    </form>
                                    <p className="text-gray-500 text-sm mt-2">
                                        User must already have an account. For permanent VIP, add email to VIP_EMAILS env var.
                                    </p>
                                </div>

                                {/* Current VIP Users */}
                                <div className="glass rounded-xl p-6">
                                    <h2 className="text-lg font-bold mb-4">
                                        <i className="fas fa-users text-yellow-500 mr-2"></i>
                                        Current VIP Users ({vipUsers.length})
                                    </h2>
                                    {vipUsers.length === 0 ? (
                                        <p className="text-gray-400 text-center py-8">No VIP users yet</p>
                                    ) : (
                                        <div className="space-y-3">
                                            {vipUsers.map(vip => (
                                                <div key={vip._id} className="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                                    <div>
                                                        <div className="font-medium">{vip.name}</div>
                                                        <div className="text-gray-500 text-sm">{vip.email}</div>
                                                    </div>
                                                    <div className="flex items-center gap-4">
                                                        {vip.isEnvVIP && (
                                                            <span className="text-yellow-500 text-sm">
                                                                <i className="fas fa-star mr-1"></i>ENV VIP
                                                            </span>
                                                        )}
                                                        <span className="text-gray-500 text-sm">
                                                            Joined: {new Date(vip.createdAt).toLocaleDateString()}
                                                        </span>
                                                        <button
                                                            onClick={() => handleRemoveVIP(vip.email)}
                                                            disabled={vip.isEnvVIP}
                                                            className={`text-red-400 hover:text-red-300 ${vip.isEnvVIP ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                            title={vip.isEnvVIP ? 'Remove from VIP_EMAILS env var to revoke' : 'Remove VIP'}
                                                        >
                                                            <i className="fas fa-times"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        // App Component
        function App() {
            const [user, setUser] = useState(null);
            const [checking, setChecking] = useState(true);

            useEffect(() => {
                const checkAuth = async () => {
                    const token = localStorage.getItem('adminToken');
                    if (token) {
                        try {
                            // Verify token and admin access
                            await api.fetch('/admin/stats');
                            // Get user info
                            const res = await api.fetch('/users/profile');
                            setUser(res.user || res);
                        } catch (err) {
                            localStorage.removeItem('adminToken');
                        }
                    }
                    setChecking(false);
                };
                checkAuth();
            }, []);

            const handleLogout = () => {
                localStorage.removeItem('adminToken');
                setUser(null);
            };

            if (checking) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-4xl"><i className="fas fa-spinner fa-spin text-orange-500"></i></div>
                    </div>
                );
            }

            if (!user) {
                return <LoginForm onLogin={setUser} />;
            }

            return <AdminDashboard user={user} onLogout={handleLogout} />;
        }

        // Render App
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
